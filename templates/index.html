<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto & Forex Market Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .selection-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .market-type-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .market-type-tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .market-type-tab:hover {
            color: #667eea;
        }

        .market-type-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .market-selection {
            display: none;
        }

        .market-selection.active {
            display: block;
        }

        .select-all-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 10px;
        }

        .select-all-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
        }

        .select-all-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .selected-count {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }

        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .market-checkbox {
            background: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s;
        }

        .market-checkbox:hover {
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .market-checkbox.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .market-checkbox label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .market-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .market-info {
            flex: 1;
        }

        .market-name {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .market-symbol {
            color: #999;
            font-size: 0.9em;
        }

        .analyze-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f9fafb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 1.2em;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-title {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }

        .results-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .results-tab {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .results-tab:hover {
            transform: translateY(-2px);
        }

        .results-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .results-content {
            display: none;
        }

        .results-content.active {
            display: block;
        }

        .market-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .market-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .market-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-market-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .card-market-symbol {
            color: #999;
            font-size: 0.9em;
        }

        .price-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .price {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .change {
            font-size: 1.2em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .change.positive {
            color: #10b981;
            background: #d1fae5;
        }

        .change.negative {
            color: #ef4444;
            background: #fee2e2;
        }

        .signal {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
            width: 100%;
            text-align: center;
        }

        .signal.STRONG_BUY {
            background: #10b981;
            color: white;
        }

        .signal.BUY {
            background: #6ee7b7;
            color: #065f46;
        }

        .signal.HOLD {
            background: #fbbf24;
            color: #78350f;
        }

        .signal.SELL {
            background: #fca5a5;
            color: #7f1d1d;
        }

        .signal.STRONG_SELL {
            background: #ef4444;
            color: white;
        }

        .strength-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .reasons {
            margin-top: 15px;
        }

        .reasons-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .reason {
            padding: 8px;
            margin: 5px 0;
            background: #f9fafb;
            border-left: 3px solid #667eea;
            border-radius: 5px;
            font-size: 0.9em;
            color: #555;
        }

        .candle-patterns {
            margin-top: 15px;
            padding: 15px;
            background: #f0f9ff;
            border-radius: 10px;
            border: 2px solid #0ea5e9;
        }

        .candle-patterns-title {
            font-weight: bold;
            color: #0369a1;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .pattern {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-left: 3px solid #0ea5e9;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .pattern-name {
            font-weight: bold;
            color: #0369a1;
        }

        .pattern-bullish {
            border-left-color: #10b981;
        }

        .pattern-bullish .pattern-name {
            color: #059669;
        }

        .pattern-bearish {
            border-left-color: #ef4444;
        }

        .pattern-bearish .pattern-name {
            color: #dc2626;
        }

        .entry-exit {
            margin-top: 15px;
            padding: 15px;
            background: #fef3c7;
            border-radius: 10px;
            border: 2px solid #f59e0b;
        }

        .entry-exit-title {
            font-weight: bold;
            color: #b45309;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .trade-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .trade-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .trade-label {
            font-size: 0.8em;
            color: #78716c;
            margin-bottom: 5px;
        }

        .trade-value {
            font-weight: bold;
            font-size: 1.1em;
            color: #292524;
        }

        .trade-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            width: 100%;
            text-align: center;
        }

        .trade-type.LONG {
            background: #10b981;
            color: white;
        }

        .trade-type.SHORT {
            background: #ef4444;
            color: white;
        }

        .trade-type.NO_TRADE {
            background: #9ca3af;
            color: white;
        }

        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }

        .disclaimer strong {
            color: #d97706;
            font-size: 1.2em;
        }

        .error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #7f1d1d;
            text-align: center;
        }

        .no-results {
            background: white;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Crypto & Forex Market Analyzer</h1>
            <p class="subtitle">Professional Technical Analysis with 40+ Indicators</p>
        </header>

        <!-- Market Selection Panel -->
        <div class="selection-panel" id="selectionPanel">
            <h2 class="section-title">Select Markets to Analyze</h2>

            <div class="market-type-tabs">
                <button class="market-type-tab active" onclick="switchMarketType('crypto')">
                    Cryptocurrencies
                </button>
                <button class="market-type-tab" onclick="switchMarketType('forex')">
                    Forex Pairs
                </button>
            </div>

            <!-- Crypto Selection -->
            <div id="crypto-selection" class="market-selection active">
                <div class="select-all-section">
                    <label class="select-all-label">
                        <input type="checkbox" id="selectAllCrypto" onchange="toggleSelectAll('crypto')">
                        Select All Cryptocurrencies
                    </label>
                    <span class="selected-count" id="cryptoCount">0 selected</span>
                </div>
                <div class="market-grid" id="cryptoGrid">
                    <!-- Crypto markets will be loaded here -->
                </div>
            </div>

            <!-- Forex Selection -->
            <div id="forex-selection" class="market-selection">
                <div class="select-all-section">
                    <label class="select-all-label">
                        <input type="checkbox" id="selectAllForex" onchange="toggleSelectAll('forex')">
                        Select All Forex Pairs
                    </label>
                    <span class="selected-count" id="forexCount">0 selected</span>
                </div>
                <div class="market-grid" id="forexGrid">
                    <!-- Forex markets will be loaded here -->
                </div>
            </div>

            <div class="analyze-section">
                <button class="btn" id="analyzeBtn" onclick="analyzeSelected()">
                    Analyze Selected Markets
                </button>
                <button class="btn btn-secondary" onclick="clearSelection()">
                    Clear Selection
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing markets with 40+ technical indicators...</p>
            <p id="loadingProgress">Preparing analysis...</p>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2 class="results-title">Analysis Results</h2>
                <button class="btn" onclick="backToSelection()">
                    Analyze More Markets
                </button>
            </div>

            <div class="results-tabs">
                <div class="results-tab active" onclick="switchResultsTab('crypto')">
                    Cryptocurrencies
                </div>
                <div class="results-tab" onclick="switchResultsTab('forex')">
                    Forex Pairs
                </div>
            </div>

            <div id="crypto-results" class="results-content active">
                <div class="market-cards-grid" id="cryptoResultsGrid"></div>
            </div>

            <div id="forex-results" class="results-content">
                <div class="market-cards-grid" id="forexResultsGrid"></div>
            </div>
        </div>

        <div class="disclaimer">
            <strong>DISCLAIMER:</strong> This tool is for educational and informational purposes only.
            It does NOT constitute financial advice. Trading cryptocurrencies and forex carries substantial
            risk of loss. Always do your own research and consult with licensed financial advisors before
            making investment decisions.
        </div>
    </div>

    <script>
        let availableMarkets = { crypto: [], forex: [] };
        let selectedMarkets = { crypto: new Set(), forex: new Set() };
        let currentMarketType = 'crypto';
        let currentResultsTab = 'crypto';

        // Load available markets on page load
        window.addEventListener('DOMContentLoaded', loadMarkets);

        async function loadMarkets() {
            try {
                const response = await fetch('/api/markets');
                const data = await response.json();

                if (data.success) {
                    availableMarkets = data.data;
                    renderMarketGrid('crypto');
                    renderMarketGrid('forex');
                }
            } catch (error) {
                console.error('Error loading markets:', error);
            }
        }

        function renderMarketGrid(type) {
            const grid = document.getElementById(`${type}Grid`);
            grid.innerHTML = '';

            availableMarkets[type].forEach(market => {
                const div = document.createElement('div');
                div.className = 'market-checkbox';
                div.id = `market-${type}-${market.symbol.replace(/[^a-zA-Z0-9]/g, '')}`;

                div.innerHTML = `
                    <label>
                        <input type="checkbox" value="${market.symbol}" onchange="toggleMarket('${type}', '${market.symbol}')">
                        <div class="market-info">
                            <div class="market-name">${market.name}</div>
                            <div class="market-symbol">${market.symbol}</div>
                        </div>
                    </label>
                `;

                grid.appendChild(div);
            });
        }

        function switchMarketType(type) {
            currentMarketType = type;

            // Update tabs
            document.querySelectorAll('.market-type-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.market-selection').forEach(selection => {
                selection.classList.remove('active');
            });
            document.getElementById(`${type}-selection`).classList.add('active');
        }

        function toggleMarket(type, symbol) {
            if (selectedMarkets[type].has(symbol)) {
                selectedMarkets[type].delete(symbol);
            } else {
                selectedMarkets[type].add(symbol);
            }

            updateSelectedCount(type);
            updateMarketCardStyle(type, symbol);
            updateSelectAllCheckbox(type);
        }

        function updateMarketCardStyle(type, symbol) {
            const card = document.getElementById(`market-${type}-${symbol.replace(/[^a-zA-Z0-9]/g, '')}`);
            if (selectedMarkets[type].has(symbol)) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        }

        function toggleSelectAll(type) {
            const checkbox = document.getElementById(`selectAll${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const checkboxes = document.querySelectorAll(`#${type}Grid input[type="checkbox"]`);

            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                const symbol = cb.value;

                if (checkbox.checked) {
                    selectedMarkets[type].add(symbol);
                } else {
                    selectedMarkets[type].delete(symbol);
                }
                updateMarketCardStyle(type, symbol);
            });

            updateSelectedCount(type);
        }

        function updateSelectAllCheckbox(type) {
            const selectAllCheckbox = document.getElementById(`selectAll${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const totalMarkets = availableMarkets[type].length;
            const selectedCount = selectedMarkets[type].size;

            selectAllCheckbox.checked = selectedCount === totalMarkets && totalMarkets > 0;
        }

        function updateSelectedCount(type) {
            const count = selectedMarkets[type].size;
            document.getElementById(`${type}Count`).textContent = `${count} selected`;
        }

        function clearSelection() {
            ['crypto', 'forex'].forEach(type => {
                selectedMarkets[type].clear();
                document.querySelectorAll(`#${type}Grid input[type="checkbox"]`).forEach(cb => {
                    cb.checked = false;
                });
                document.querySelectorAll(`#${type}Grid .market-checkbox`).forEach(card => {
                    card.classList.remove('selected');
                });
                updateSelectedCount(type);
                updateSelectAllCheckbox(type);
            });
        }

        async function analyzeSelected() {
            const totalSelected = selectedMarkets.crypto.size + selectedMarkets.forex.size;

            if (totalSelected === 0) {
                alert('Please select at least one market to analyze');
                return;
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const selectionPanel = document.getElementById('selectionPanel');
            const resultsSection = document.getElementById('resultsSection');

            analyzeBtn.disabled = true;
            loading.classList.add('active');
            selectionPanel.style.display = 'none';
            resultsSection.classList.remove('active');

            try {
                const requestData = {
                    crypto: Array.from(selectedMarkets.crypto),
                    forex: Array.from(selectedMarkets.forex)
                };

                document.getElementById('loadingProgress').textContent =
                    `Analyzing ${totalSelected} market${totalSelected > 1 ? 's' : ''}...`;

                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                if (data.success) {
                    displayResults(data.data);
                    resultsSection.classList.add('active');
                } else {
                    alert('Error: ' + data.error);
                    selectionPanel.style.display = 'block';
                }
            } catch (error) {
                alert('Failed to analyze markets: ' + error.message);
                selectionPanel.style.display = 'block';
            } finally {
                analyzeBtn.disabled = false;
                loading.classList.remove('active');
            }
        }

        function displayResults(data) {
            displayMarketResults(data.crypto, 'cryptoResultsGrid');
            displayMarketResults(data.forex, 'forexResultsGrid');
        }

        function displayMarketResults(markets, gridId) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';

            if (!markets || markets.length === 0) {
                grid.innerHTML = '<div class="no-results">No results to display</div>';
                return;
            }

            markets.forEach(market => {
                const card = createMarketCard(market);
                grid.appendChild(card);
            });
        }

        function createMarketCard(market) {
            const card = document.createElement('div');
            card.className = 'market-card';

            const changeClass = market.change_24h >= 0 ? 'positive' : 'negative';
            const changeSign = market.change_24h >= 0 ? '+' : '';
            const signalClass = market.signal.replace(' ', '_');

            // Generate 5-minute candlestick patterns HTML (short-term/scalping)
            let patterns5mHTML = '';
            if (market.candle_patterns_5m && market.candle_patterns_5m.length > 0) {
                patterns5mHTML = `
                    <div class="candle-patterns" style="background: #fff7ed; border-color: #f97316;">
                        <div class="candle-patterns-title" style="color: #c2410c;">⚡ 5-Minute Patterns (Scalping/Day Trading)</div>
                        ${market.candle_patterns_5m.map(pattern => `
                            <div class="pattern pattern-${pattern.type}">
                                <span class="pattern-name">${pattern.name}</span>
                                <span style="float: right; color: #666;">Strength: ${pattern.strength}/10</span>
                                <div style="clear: both; margin-top: 5px; font-size: 0.85em; color: #666;">
                                    ${pattern.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Generate 4-hour candlestick patterns HTML (medium-term/swing trading)
            let patterns4hHTML = '';
            if (market.candle_patterns_4h && market.candle_patterns_4h.length > 0) {
                patterns4hHTML = `
                    <div class="candle-patterns">
                        <div class="candle-patterns-title">📊 4-Hour Patterns (Swing Trading)</div>
                        ${market.candle_patterns_4h.map(pattern => `
                            <div class="pattern pattern-${pattern.type}">
                                <span class="pattern-name">${pattern.name}</span>
                                <span style="float: right; color: #666;">Strength: ${pattern.strength}/10</span>
                                <div style="clear: both; margin-top: 5px; font-size: 0.85em; color: #666;">
                                    ${pattern.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // For backward compatibility, also check old key
            if (!patterns4hHTML && market.candle_patterns && market.candle_patterns.length > 0) {
                patterns4hHTML = `
                    <div class="candle-patterns">
                        <div class="candle-patterns-title">📊 4-Hour Patterns (Swing Trading)</div>
                        ${market.candle_patterns.map(pattern => `
                            <div class="pattern pattern-${pattern.type}">
                                <span class="pattern-name">${pattern.name}</span>
                                <span style="float: right; color: #666;">Strength: ${pattern.strength}/10</span>
                                <div style="clear: both; margin-top: 5px; font-size: 0.85em; color: #666;">
                                    ${pattern.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Generate entry/exit HTML
            let entryExitHTML = '';
            if (market.entry_exit && market.entry_exit.trade_type !== 'NO TRADE') {
                const ee = market.entry_exit;
                entryExitHTML = `
                    <div class="entry-exit">
                        <div class="entry-exit-title">💰 Trading Setup</div>
                        <div class="trade-type ${ee.trade_type.replace(' ', '_')}">
                            ${ee.trade_type}
                        </div>
                        <div style="font-size: 0.9em; color: #78716c; margin-bottom: 10px;">
                            ${ee.recommendation}
                        </div>
                        ${ee.stop_loss_reasoning ? `
                        <div style="font-size: 0.85em; color: #78716c; margin-bottom: 5px; padding: 8px; background: white; border-radius: 5px;">
                            <strong>Stop Loss:</strong> ${ee.stop_loss_reasoning}
                        </div>
                        ` : ''}
                        ${ee.take_profit_reasoning ? `
                        <div style="font-size: 0.85em; color: #78716c; margin-bottom: 10px; padding: 8px; background: white; border-radius: 5px;">
                            <strong>Take Profit:</strong> ${ee.take_profit_reasoning}
                        </div>
                        ` : ''}
                        <div class="trade-info">
                            <div class="trade-item">
                                <div class="trade-label">Entry Price</div>
                                <div class="trade-value">$${ee.entry_price}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Stop Loss</div>
                                <div class="trade-value" style="color: #ef4444;">$${ee.stop_loss}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Take Profit</div>
                                <div class="trade-value" style="color: #10b981;">$${ee.take_profit}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Risk/Reward</div>
                                <div class="trade-value">1:${ee.risk_reward_ratio}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Risk Amount</div>
                                <div class="trade-value">${ee.risk_percent}%</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Potential Profit</div>
                                <div class="trade-value" style="color: #10b981;">+${ee.potential_profit_percent}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            card.innerHTML = `
                <div class="market-header">
                    <div>
                        <div class="card-market-name">${market.name || market.symbol}</div>
                        <div class="card-market-symbol">${market.symbol}</div>
                    </div>
                </div>

                <div class="price-info">
                    <div class="price">$${market.current_price ? market.current_price.toFixed(2) : 'N/A'}</div>
                    <div class="change ${changeClass}">
                        ${market.change_24h ? changeSign + market.change_24h.toFixed(2) + '%' : 'N/A'}
                    </div>
                </div>

                <div class="signal ${signalClass}">
                    ${market.signal}
                </div>

                <div class="strength-bar">
                    <div class="strength-fill" style="width: ${market.strength}%">
                        ${market.strength.toFixed(1)}%
                    </div>
                </div>

                <div class="reasons">
                    <div class="reasons-title">Analysis Factors:</div>
                    ${market.reasons.slice(0, 5).map(reason =>
                        `<div class="reason">${reason}</div>`
                    ).join('')}
                </div>

                ${patterns5mHTML}
                ${patterns4hHTML}
                ${entryExitHTML}
            `;

            return card;
        }

        function switchResultsTab(tab) {
            currentResultsTab = tab;

            // Update tab buttons
            document.querySelectorAll('.results-tab').forEach(t => {
                t.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.results-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-results`).classList.add('active');
        }

        function backToSelection() {
            document.getElementById('selectionPanel').style.display = 'block';
            document.getElementById('resultsSection').classList.remove('active');
        }
    </script>
</body>
</html>
