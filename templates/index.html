<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto & Forex Market Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 1.2em;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .tab:hover {
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .market-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .market-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .market-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .market-symbol {
            color: #999;
            font-size: 0.9em;
        }

        .price-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .price {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .change {
            font-size: 1.2em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .change.positive {
            color: #10b981;
            background: #d1fae5;
        }

        .change.negative {
            color: #ef4444;
            background: #fee2e2;
        }

        .signal {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
            width: 100%;
            text-align: center;
        }

        .signal.STRONG_BUY {
            background: #10b981;
            color: white;
        }

        .signal.BUY {
            background: #6ee7b7;
            color: #065f46;
        }

        .signal.HOLD {
            background: #fbbf24;
            color: #78350f;
        }

        .signal.SELL {
            background: #fca5a5;
            color: #7f1d1d;
        }

        .signal.STRONG_SELL {
            background: #ef4444;
            color: white;
        }

        .strength-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .reasons {
            margin-top: 15px;
        }

        .reasons-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .reason {
            padding: 8px;
            margin: 5px 0;
            background: #f9fafb;
            border-left: 3px solid #667eea;
            border-radius: 5px;
            font-size: 0.9em;
            color: #555;
        }

        .candle-patterns {
            margin-top: 15px;
            padding: 15px;
            background: #f0f9ff;
            border-radius: 10px;
            border: 2px solid #0ea5e9;
        }

        .candle-patterns-title {
            font-weight: bold;
            color: #0369a1;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .pattern {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-left: 3px solid #0ea5e9;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .pattern-name {
            font-weight: bold;
            color: #0369a1;
        }

        .pattern-bullish {
            border-left-color: #10b981;
        }

        .pattern-bullish .pattern-name {
            color: #059669;
        }

        .pattern-bearish {
            border-left-color: #ef4444;
        }

        .pattern-bearish .pattern-name {
            color: #dc2626;
        }

        .entry-exit {
            margin-top: 15px;
            padding: 15px;
            background: #fef3c7;
            border-radius: 10px;
            border: 2px solid #f59e0b;
        }

        .entry-exit-title {
            font-weight: bold;
            color: #b45309;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .trade-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .trade-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .trade-label {
            font-size: 0.8em;
            color: #78716c;
            margin-bottom: 5px;
        }

        .trade-value {
            font-weight: bold;
            font-size: 1.1em;
            color: #292524;
        }

        .trade-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            width: 100%;
            text-align: center;
        }

        .trade-type.LONG {
            background: #10b981;
            color: white;
        }

        .trade-type.SHORT {
            background: #ef4444;
            color: white;
        }

        .trade-type.NO_TRADE {
            background: #9ca3af;
            color: white;
        }

        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }

        .disclaimer strong {
            color: #d97706;
            font-size: 1.2em;
        }

        .error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #7f1d1d;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Crypto & Forex Market Analyzer</h1>
            <p class="subtitle">Professional Technical Analysis with 40+ Indicators</p>
        </header>

        <div class="controls">
            <button class="btn" id="analyzeBtn" onclick="analyzeMarkets()">
                Analyze Markets
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing markets with 40+ technical indicators...</p>
            <p>This may take 30-60 seconds...</p>
        </div>

        <div id="results" style="display: none;">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('opportunities')">
                    Top Opportunities
                </div>
                <div class="tab" onclick="switchTab('crypto')">
                    Cryptocurrencies
                </div>
                <div class="tab" onclick="switchTab('forex')">
                    Forex Pairs
                </div>
            </div>

            <div id="opportunities" class="tab-content active">
                <div class="market-grid" id="opportunitiesGrid"></div>
            </div>

            <div id="crypto" class="tab-content">
                <div class="market-grid" id="cryptoGrid"></div>
            </div>

            <div id="forex" class="tab-content">
                <div class="market-grid" id="forexGrid"></div>
            </div>
        </div>

        <div class="disclaimer">
            <strong>DISCLAIMER:</strong> This tool is for educational and informational purposes only.
            It does NOT constitute financial advice. Trading cryptocurrencies and forex carries substantial
            risk of loss. Always do your own research and consult with licensed financial advisors before
            making investment decisions.
        </div>
    </div>

    <script>
        let currentTab = 'opportunities';

        function switchTab(tabName) {
            currentTab = tabName;

            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }

        async function analyzeMarkets() {
            const btn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');

            btn.disabled = true;
            loading.classList.add('active');
            results.style.display = 'none';

            try {
                const response = await fetch('/api/analyze');
                const data = await response.json();

                if (data.success) {
                    displayResults(data.data);
                    results.style.display = 'block';
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('Failed to analyze markets: ' + error.message);
            } finally {
                btn.disabled = false;
                loading.classList.remove('active');
            }
        }

        function displayResults(data) {
            displayMarkets(data.top_opportunities, 'opportunitiesGrid');
            displayMarkets(data.crypto, 'cryptoGrid');
            displayMarkets(data.forex, 'forexGrid');
        }

        function displayMarkets(markets, gridId) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';

            if (!markets || markets.length === 0) {
                grid.innerHTML = '<p class="error">No markets to display</p>';
                return;
            }

            markets.forEach(market => {
                const card = createMarketCard(market);
                grid.appendChild(card);
            });
        }

        function createMarketCard(market) {
            const card = document.createElement('div');
            card.className = 'market-card';

            const changeClass = market.change_24h >= 0 ? 'positive' : 'negative';
            const changeSign = market.change_24h >= 0 ? '+' : '';
            const signalClass = market.signal.replace(' ', '_');

            // Generate candlestick patterns HTML
            let patternsHTML = '';
            if (market.candle_patterns && market.candle_patterns.length > 0) {
                patternsHTML = `
                    <div class="candle-patterns">
                        <div class="candle-patterns-title">ðŸ“Š Candlestick Patterns (4H Chart)</div>
                        ${market.candle_patterns.map(pattern => `
                            <div class="pattern pattern-${pattern.type}">
                                <span class="pattern-name">${pattern.name}</span>
                                <span style="float: right; color: #666;">Strength: ${pattern.strength}/10</span>
                                <div style="clear: both; margin-top: 5px; font-size: 0.85em; color: #666;">
                                    ${pattern.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Generate entry/exit HTML
            let entryExitHTML = '';
            if (market.entry_exit && market.entry_exit.trade_type !== 'NO TRADE') {
                const ee = market.entry_exit;
                entryExitHTML = `
                    <div class="entry-exit">
                        <div class="entry-exit-title">ðŸ’° Trading Setup</div>
                        <div class="trade-type ${ee.trade_type.replace(' ', '_')}">
                            ${ee.trade_type}
                        </div>
                        <div style="font-size: 0.9em; color: #78716c; margin-bottom: 10px;">
                            ${ee.recommendation}
                        </div>
                        ${ee.stop_loss_reasoning ? `
                        <div style="font-size: 0.85em; color: #78716c; margin-bottom: 5px; padding: 8px; background: white; border-radius: 5px;">
                            <strong>Stop Loss:</strong> ${ee.stop_loss_reasoning}
                        </div>
                        ` : ''}
                        ${ee.take_profit_reasoning ? `
                        <div style="font-size: 0.85em; color: #78716c; margin-bottom: 10px; padding: 8px; background: white; border-radius: 5px;">
                            <strong>Take Profit:</strong> ${ee.take_profit_reasoning}
                        </div>
                        ` : ''}
                        <div class="trade-info">
                            <div class="trade-item">
                                <div class="trade-label">Entry Price</div>
                                <div class="trade-value">$${ee.entry_price}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Stop Loss (30%)</div>
                                <div class="trade-value" style="color: #ef4444;">$${ee.stop_loss}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Take Profit (200%)</div>
                                <div class="trade-value" style="color: #10b981;">$${ee.take_profit}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Risk/Reward</div>
                                <div class="trade-value">1:${ee.risk_reward_ratio}</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Risk Amount</div>
                                <div class="trade-value">${ee.risk_percent}%</div>
                            </div>
                            <div class="trade-item">
                                <div class="trade-label">Potential Profit</div>
                                <div class="trade-value" style="color: #10b981;">+${ee.potential_profit_percent}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            card.innerHTML = `
                <div class="market-header">
                    <div>
                        <div class="market-name">${market.name || market.symbol}</div>
                        <div class="market-symbol">${market.symbol}</div>
                    </div>
                </div>

                <div class="price-info">
                    <div class="price">$${market.current_price ? market.current_price.toFixed(2) : 'N/A'}</div>
                    <div class="change ${changeClass}">
                        ${market.change_24h ? changeSign + market.change_24h.toFixed(2) + '%' : 'N/A'}
                    </div>
                </div>

                <div class="signal ${signalClass}">
                    ${market.signal}
                </div>

                <div class="strength-bar">
                    <div class="strength-fill" style="width: ${market.strength}%">
                        ${market.strength.toFixed(1)}%
                    </div>
                </div>

                <div class="reasons">
                    <div class="reasons-title">Analysis Factors:</div>
                    ${market.reasons.slice(0, 5).map(reason =>
                        `<div class="reason">${reason}</div>`
                    ).join('')}
                </div>

                ${patternsHTML}
                ${entryExitHTML}
            `;

            return card;
        }

        function showError(message) {
            const results = document.getElementById('results');
            results.style.display = 'block';
            results.innerHTML = `<div class="error"><strong>Error:</strong> ${message}</div>`;
        }
    </script>
</body>
</html>
